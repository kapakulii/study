<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <style>
        body {
            font-family: Futura, sans-serif;
            background-color: #27272A;
            color: white;
            margin: 0;
            padding: 20px;
            font-size: 12px;
        }

        span {
            width: 100%;
        }

        h2 {
            display: flex;
            justify-content: left;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
            font-size: 24px;
        }

        .task-container {
            margin-bottom: 20px;
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0 0 10px 0;
        }

        li {
            padding: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            /* –ù—É–∂–Ω–æ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        li.move {
            transform: translateY(30px);
            /* –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ 30px –≤–Ω–∏–∑ (–¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏) */
            opacity: 0;
            /* –°–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        }

        li.move-down {
            transform: translateY(30px);
            /* –î–≤–∏–≥–∞–µ–º –∑–∞–¥–∞—á—É –≤–Ω–∏–∑ */
            opacity: 0;
        }

        li.move-up {
            transform: translateY(-30px);
            /* –î–≤–∏–≥–∞–µ–º –∑–∞–¥–∞—á—É –≤–≤–µ—Ä—Ö */
            opacity: 0;
        }

        li:hover {
            background: #364153;
        }

        .buttons {
            display: flex;
            gap: 4px;
        }

        button {
            background: #222225;
            border: none;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
        }

        textarea {
            width: calc(100% - 20px);
            border: none;
            resize: none;
            background: transparent;
            color: white;
            font-family: futura, sans-serif;
            font-size: 12px;
            height: 16px;
            padding: 0;
        }

        textarea:focus,
        textarea:active {
            outline: none;
        }

        .pagewrapper {
            max-width: 760px;
            display: flex;
            flex-direction: column;
            margin: auto;
            gap: 40px;
        }

        .completed {
            text-decoration: line-through;
            color: gray;
        }

        .text-size-small {
            font-size: 12px;
        }

        .new-task-wrapper {
            padding-left: 32px;
            padding-top: 2px;
        }

        input[type="checkbox"] {
            width: 12px;
            height: 12px;
            margin-right: 8px;
        }
    </style>
</head>

<body>
    <div class="pagewrapper">
        <div class="task-container">
            <h2>
                –°–µ–≥–æ–¥–Ω—è <span class="text-size-small" id="today-date"></span>
                <button onclick="clearList('today')">üóëÔ∏è</button>
            </h2>
            <ul id="today-list"></ul>
            <div class="new-task-wrapper"><textarea id="new-task-today" placeholder="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞"
                    onkeydown="handleKeyPress(event, 'today')"></textarea>
            </div>
        </div>

        <div class="task-container">
            <h2>
                –ó–∞–≤—Ç—Ä–∞ <span class="text-size-small" id="tomorrow-date"></span>
                <button onclick="clearList('tomorrow')">üóëÔ∏è</button>
            </h2>
            <ul id="tomorrow-list"></ul>
            <div class="new-task-wrapper"><textarea id="new-task-tomorrow" placeholder="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞"
                    onkeydown="handleKeyPress(event, 'tomorrow')"></textarea>
            </div>
        </div>
    </div>

    <script>
        const todayList = document.getElementById('today-list');
        const tomorrowList = document.getElementById('tomorrow-list');

        function loadTasks() {
            const todayTasks = JSON.parse(localStorage.getItem('today-tasks')) || [];
            const tomorrowTasks = JSON.parse(localStorage.getItem('tomorrow-tasks')) || [];
            todayList.innerHTML = '';
            tomorrowList.innerHTML = '';
            todayTasks.forEach(task => addTaskToList(task.text, 'today', task.completed));
            tomorrowTasks.forEach(task => addTaskToList(task.text, 'tomorrow', task.completed));
        }

        function saveTasks() {
            const todayTasks = Array.from(todayList.children).map(li => ({
                text: li.querySelector('span').textContent.trim(),
                completed: li.querySelector('input[type="checkbox"]').checked
            }));
            const tomorrowTasks = Array.from(tomorrowList.children).map(li => ({
                text: li.querySelector('span').textContent.trim(),
                completed: li.querySelector('input[type="checkbox"]').checked
            }));
            localStorage.setItem('today-tasks', JSON.stringify(todayTasks));
            localStorage.setItem('tomorrow-tasks', JSON.stringify(tomorrowTasks));
        }

        function addTask(list) {
            const input = document.getElementById(`new-task-${list}`);
            const tasks = input.value.trim().split('\n').filter(task => task);
            tasks.reverse().forEach(task => addTaskToList(task, list));
            saveTasks();
            input.value = '';
        }

        function handleKeyPress(event, list) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                addTask(list);
            }
        }

        function addTaskToList(task, list, completed = false) {
            const li = document.createElement('li');

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = completed;
            checkbox.onchange = () => {
                taskText.classList.toggle('completed', checkbox.checked);
                saveTasks();
            };

            const taskText = document.createElement('span');
            taskText.textContent = task;
            if (completed) {
                taskText.classList.add('completed');
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
            taskText.addEventListener('click', (event) => {
                const textarea = document.createElement('textarea');
                textarea.value = taskText.textContent;

                // –ó–∞–º–µ–Ω—è–µ–º span –Ω–∞ textarea
                li.replaceChild(textarea, taskText);
                textarea.focus();

                // –û—Ç–º–µ–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ, –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —Å–∞–º —Ç–µ–∫—Å—Ç
                event.stopPropagation();

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—Ç–µ—Ä–∏ —Ñ–æ–∫—É—Å–∞ (–∫–ª–∏–∫ –≤–Ω–µ textarea)
                const onClickOutside = (event) => {
                    if (!li.contains(event.target)) {
                        taskText.textContent = textarea.value;
                        li.replaceChild(taskText, textarea);
                        saveTasks();
                        document.removeEventListener('click', onClickOutside);
                    }
                };

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∫–ª–∏–∫ –≤–Ω–µ textarea
                document.addEventListener('click', onClickOutside);

                // –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ Enter, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                textarea.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        taskText.textContent = textarea.value;
                        li.replaceChild(taskText, textarea);
                        saveTasks();
                        event.preventDefault();
                    } else if (event.key === 'Escape') {
                        li.replaceChild(taskText, textarea);  // –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                    }
                });
            });

            const buttons = document.createElement('div');
            buttons.className = 'buttons';

            const moveBtn = document.createElement('button');
            moveBtn.textContent = list === 'today' ? '–ù–∞ –∑–∞–≤—Ç—Ä–∞' : '–ù–∞ —Å–µ–≥–æ–¥–Ω—è';
            moveBtn.onclick = () => {
                moveTask(li);
            };

            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = '‚úñ';
            deleteBtn.onclick = () => {
                li.remove();
                saveTasks();
            };

            buttons.appendChild(moveBtn);
            buttons.appendChild(deleteBtn);
            li.appendChild(checkbox);
            li.appendChild(taskText);
            li.appendChild(buttons);

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞
            document.getElementById(`${list}-list`).appendChild(li);
        }

        function moveTask(task) {
            const currentList = task.parentElement.id === 'today-list' ? 'today' : 'tomorrow';
            const targetList = currentList === 'today' ? 'tomorrow' : 'today';

            // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∏–∑ –∫–∞–∫–æ–≥–æ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞, –¥–æ–±–∞–≤–ª—è–µ–º –Ω—É–∂–Ω—ã–π –∫–ª–∞—Å—Å
            if (currentList === 'today') {
                task.classList.add('move-down'); // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤–Ω–∏–∑
            } else {
                task.classList.add('move-up'); // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤–≤–µ—Ä—Ö
            }

            // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–º–µ—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
            setTimeout(() => {
                task.classList.remove('move-down', 'move-up'); // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã –∞–Ω–∏–º–∞—Ü–∏–∏

                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∑–∞–¥–∞—á—É –≤ –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫
                document.getElementById(`${targetList}-list`).appendChild(task);

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
                const moveBtn = task.querySelector('button:first-child');
                moveBtn.textContent = currentList === 'today' ? '–ù–∞ —Å–µ–≥–æ–¥–Ω—è' : '–ù–∞ –∑–∞–≤—Ç—Ä–∞';

                saveTasks();
            }, 300); // –¢–∞–π–º–∞—É—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∞–Ω–∏–º–∞—Ü–∏–∏ (0.3s)
        }

        function clearList(list) {
            const taskList = list === 'today' ? todayList : tomorrowList;
            taskList.innerHTML = '';
            saveTasks();
        }

        function updateDates() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);

            document.getElementById('today-date').textContent = `${today.getDate()}, ${today.toLocaleDateString('ru-RU', { weekday: 'long' })}`;
            document.getElementById('tomorrow-date').textContent = `${tomorrow.getDate()}, ${tomorrow.toLocaleDateString('ru-RU', { weekday: 'long' })}`;
        }

        function clearCompletedTasks() {
            const todayTasks = Array.from(todayList.children).filter(li => !li.querySelector('input[type="checkbox"]').checked);
            todayList.innerHTML = '';
            todayTasks.forEach(task => todayList.appendChild(task));
            saveTasks();
        }

        function shiftTasks() {
            const today = new Date();
            const lastVisit = new Date(localStorage.getItem('last-visit') || 0);
            if (today.toDateString() !== lastVisit.toDateString()) {
                const tomorrowTasks = JSON.parse(localStorage.getItem('tomorrow-tasks')) || [];
                const todayTasks = JSON.parse(localStorage.getItem('today-tasks')) || [];
                localStorage.setItem('today-tasks', JSON.stringify([...todayTasks, ...tomorrowTasks]));
                localStorage.setItem('tomorrow-tasks', JSON.stringify([]));
                clearCompletedTasks();
                localStorage.setItem('last-visit', today);
            }
        }

        shiftTasks();
        updateDates();
        loadTasks();
    </script>
</body>

</html>